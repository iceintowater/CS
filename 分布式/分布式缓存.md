<!-- GFM-TOC -->
本文由两部分组成，先介绍redis[包括数据结构、对象、持久化、分布式]，以及缓存在电商中应用。

# 一、redis

## 五种数据结构：sds、链表、字典【渐进式哈希】、跳表、整数集合 【数组、编码升级】、压缩列表【连锁更新】

## 五个对象：
字符串、队列、哈希、集合、有序集合。
字符串：sds或者整数
队列：双端链表、压缩列表
哈希：压缩列表、字典
集合：整数集合、hashtable
有序集合：压缩列表【对象或值】、字典+跳表

## 持久化
rdb 
创建 save/bgsave【异步】
载入 自动载入
aof 
创建 将写命令写入文件中
【aof重写，子进程创建aof文件时，创建一个aof重写缓冲区，记录服务器执行的所有写命令】
载入 从AOF文件分析并读取一条写命令，并执行
save,bgsave,bgrewriteaof都不会有过期健，从数据库只有收到主发的del才会删除过期健

## 分布式

### 复制
（1）初始化复制
主：rdb快照+期间缓存命令 传给从数据库 =》从：载入并执行缓存命令
（2）复制同步
读写分离、异步复制、最终一致性
（3）增量复制【断机重连】

### 从数据库持久化
（1）从数据库挂了
主数据库自动把数据同步过来
（2）主数据库挂了
1、从上升主2、主上升从

### 哨兵
系统监控和容灾防护：主redis挂了、独立进程
### 集群
（1）解决单机redis受限问题，水平扩容。
（2）最低要求3个主。
（3）健与槽对应：hash值、索引值
（4）水平扩容
客户端分片 
    普通分片 客户端决定哪些片部署在哪些机器上，集群集体下线
    预分片 预先估计好规模
    redis 槽分片在线迁移
（5）故障检测与恢复

## redis与memcache区别
支持字符串、列表、哈希、有序列表和集合
原生集群
持久化
支持事务
线程模型：文件事件处理器
内存管理：redis有自己的内存管理

# 二、分布式缓存 redis应用
远端缓存
reload   helios服务定时从db更新、应用服务写方法回调
load    查看数据库
本地缓存
quartz本机调度
本地应用服务应用更新
